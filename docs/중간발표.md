![LOGO](img/logo_pink.png)
# 중간 발표

## 진행상황

### 1주차

- 크롤링
- 프로젝트 생성
- 서버 배포 자동화
- 숙박 관련 기능 구현
    - 검색
    - 상세보기
- 예약 관련 기능 구현
    - 예약 변경
    - 내역 조회
- 회원 관련 기능 구현
    - 회원 가입
    - 회원 정보 조회
    - 회원 탈퇴
    - 회원 정보 수정
- JWT 이용한 로그인 기능 구현

### 2주차

- 북마크 관련 기능 구현
    - 멤버별 북마크 가져오기
    - 북마크 등록
    - 북마크 제거
- 리뷰 관련 기능 구현
    - 리뷰 등록
    - 리뷰 상세보기
    - 리뷰 수정
    - 리뷰 삭제
- 예약 관련 기능 구현
    - 예약 하기
    - 예약 취소
- Google 로그인 기능 구현
- 로그아웃 기능 구현
    - Redis활용

### 3주차 (진행중)

- API 변경 요청 적용
- 기능별 테스트 보충
- 코드 리팩토링

# 남은 진행계획

- 로드테스트
- 결제 기능 구현(희망사항)
- API 문서화
- 최종 배포
- 최종 발표 준비
- 최종 통합 테스트

# 페이지별 기능 설명

## **1. 메인 페이지 & 계정 페이지**

- 회원가입
  - 클라이언트에서 회원 가입 정보 받아서 입력값에 대한 검증과 email 중복여부를 확인하여 통과하면 회원 정보를 입력합니다.
- 일반 로그인
  - email과 비밀번호를 받아 입력값을 검증을 한뒤에  SrpingSecurity를 통해 인증을 진행하여 통과하면  Jwt토큰을 만들어서 Response Header와 Body에 담아 응답합니다
    - Jwt토큰은 만료시간이 정해져있어서 일정시간 이후 해당 토큰은 인증에 실패하고 다시 로그인을 하도록 합니다
- 구글 로그인
  - 클라이언트에서 넘겨준 1회용 토큰을 통해 구글서버에 재 요청을 하여 토큰과 유저정보를 받아 회원으로 가입되어있는지 확인합니다
    - 회원이 아닌 경우 email을 포함한 회원정보를 응답으로 주어 회원가입에 활용할수 있도록 합니다.
    - 회원인 경우 로그인 처리이후 Jwt토큰을 내려줍니다
- 로그아웃
  - 요청 헤더에 담긴 토큰을 받아 Redis에 입력합니다
    - 다음 토큰 검증시 Redis에 해당 토큰이 있다면 만료된 토큰이기 때문에 인증이 되지 않은 사용자라고 응답합니다
- 회원정보 조회
  - 회원id로 회원정보 요청시 회원 정보 찾아서 응답합니다
- 회원 탈퇴
  - 회원id로 요청시 회원에 isDelete를 true로 바꾸어 주어 SoftDelete하도록 구현하였습니다.
    - isDelete가 true인경우 DB 검색시 포함되지 않도록 처리해주었습니다.
  
## **2. 검색 페이지**
- 메인 검색
  - 메인페이지에서 메인 검색을 하게 되면 원하는 지역, 체크인, 체크아웃 날짜, 인원에 따라 예약이 가능한 숙소목록을 찾아서 프론트로 전달합니다. 검색 결과 나온 숙소의 개수, 총 페이지 수 등도 포함하여 함께 전달. 동적쿼리를 사용하여 4가지 파라미터를 모두 받을 필요없이 사용자가 원하는 값만 입력해도 됩니다.
- 지도를 이용한 검색
  - 지도를 이동하면, 지도검색용 API로 Get 요청이 옵니다. 파라미터로 지도의 최소최대 위도 경도를 받아서, 그 안에 있는 숙소를 프론트로 전달합니다.
- 검색시 헤드에 토큰이 들어있는 경우(로그인이 되어있는 경우), 해당 멤버의 각 숙소의 북마크 여부도 전달합니다.

## **3. 숙소 상세정보 페이지**

- 검색페이지에서 사용자가 원하는 숙소를 클릭하면 해당 숙소 상세보기 API로 요청이 오고, 숙소의 id를 통해 숙소 정보를 프론트로 전달합니다.
- 또한 숙소와 연관 되어 있는 리뷰들과 예약 날짜들을 찾아 함께 전달합니다.
- 또한 헤드에 토큰이 들어있는 경우, 해당 멤버의 북마크 여부를 함께 전달합니다.

## 4. 예약 내역 페이지 / 저장 목록 페이지
- 예약 내역 조회
  - 멤버 Id로 API Get 요청이 오게 되면, 멤버 Id를 통해서 예약에 대한 정보를 가져와서 예약 내역 리스트를 반환해주게 됩니다.
- 리뷰
  - 리뷰 보기 Get 요청이 오면 해당 예약 id에 해당하는 리뷰를 찾아 프론트로 전달.
  - 리뷰 작성 Post 요청이 오면 별점, 내용 등 데이터를 받아 DB에 저장.
## 5. 결제 페이지 / 예약 수정 및 취소 페이지
- 예약 수정
  1. 들어온 값에 대해서 컨트롤러에서 validation을 거치게 됩니다.
  2. 통과되면 예약 Id를 통해 예약을 DB에서 가져옵니다.
  3. 그런 다음 먼저,해당 예약에 대한 예약되어 있던 날짜를 먼저 삭제를 하게 됩니다.
  4. 다음, request로 들어온 숙박 id와 체크인 과 체크아웃 날짜를 통해서 이미 예약된 날짜인지 확인하는 쿼리를 거친 다음에,
  5. 반환된 값이 있으면 중복된 날짜로 예외가 발생하고, 삭제 되었던 예약된 날짜들은 트랜잭션을 통해 다시 DB에 남게 됩니다.
  6. 반환된 값이 없게 되면 예약가능한 날짜여서 예약 수정에 대한 처리가 이루어집니다.
* 예약하기
  * 예약하기부분은 예약 수정하기 와 비슷하게 구현이 되어 있습니다.
- 예약 취소
  * 예약 Id를 통해 API 요청이 오면, 예약 Id를 통해서 예약에 대한 정보를 삭제하고 cascade를 통해서 BookedDate(예약된 날짜)들도 함께 삭제하게 됩니다.
  
## 6. **서버 배포**

- Github의 Actions, Secrets과 AWS의 EC2, S3, Code Deploy를 활용하여 Main Branch로 Push할 경우 트리거가 작동하여 서버에 자동으로 배포되도록 구현.

## 7. **크롤링**

- Python의 BeautifulSoup4, Selenium을 활용하여 원하는 지역을 입력하여 검색되어 나온 모든 숙소 정보와 리뷰, 사진을 크롤링하여 JSON파일로 저장
- 그 후 해당 파일을 읽어 pymysql을 이용하여 서버에 있는 DB에 저장

### 크롤링 현황

- 강릉시 4036개
- 고양시 787개
- 광주광역시 1128개
- 남양주시 961개
- 대전광역시 1080개
- 부산광역시 3445개
- 서울특별시 6509개
- 속초시 1768개
- 수원시 1074개
- 양양군 1138개
- 양평군 950개
- 인천광역시 1859개
- 제주시 2057개
- 춘천시 3106개

![LOGO](img/logo_pink.png)